<!DOCTYPE html>
<html>
    <head>
        <title>Log Viewer</title>
        <link rel="stylesheet" type="text/css" href="/style.css" />
        <link rel="icon" type="image/x-icon" href="../images/favicon.ico" />
        <meta content="Log Viewer" property="og:title" />
        <meta content="allows you to scroll through logs and sort by log level" property="og:description" />
        <meta content="https://pepperbot.online" property="og:url" />
        <meta content="#ff0000" data-react-helmet="true" name="theme-color" />
    </head>
    <body>
        <script src="/scripts/tv.js"></script>
        <script src="/scripts/sidebar.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <div class="outlined logPageContainer">
            <div id="logControllerContainer" class="logControllerContainer">
                <button class="logLevelButton" id="GLOBAL">GLOBAL</button>
                <button class="logLevelButton" id="INFO">INFO</button>
                <button class="logLevelButton" id="DEBUG">DEBUG</button>
                <button class="logLevelButton" id="WARN">WARN</button>
                <button class="logLevelButton" id="ERROR">ERROR</button>
                <button class="logLevelButton" id="FATAL">FATAL</button>
                <button class="logLevelButton" id="ACCESS">ACCESS</button>
                <span class="outlined logReaderStatus">awaiting input...</span>
            </div>
            <pre id="logContent" class="logContent outlined"></pre>
        </div>
        <script id="sidebarAdjustments">
            function editTextAreaSize(sidebarState) {
                const logController = document.getElementById("logControllerContainer")
                const logContent = document.getElementById("logContent")
                if (window.innerWidth < 768) {
                    logContent.style.width = "calc(100% - 12px)"
                    logController.style.width = "100%"
                } else if (sidebarState) {
                    logContent.style.width = "calc(100% - 137px)"
                    logController.style.width = "calc(100% - 125px);"
                } else {
                    logContent.style.width = "calc(100% - 12px)"
                    logController.style.width = "100%"
                }
            }
            bindToSidebarToggle(editTextAreaSize)
            setButtonPositionOffset(11)
        </script>
        <script id="logProcessor">
            const testText = `11/14 17:09:46 DBG hi
11/14 17:09:46 INF hi 11/14 17:09:46 INF hi
11/14 17:09:46 WRN hi <h2>hiiiiiii</h2>
11/14 17:09:46 ERROR hi
11/14 17:09:46 FATAL hi
11/14 17:09:46 ACCESS hi`
            const logRegex = /(\d{2}\/\d{2} \d{2}:\d{2}:\d{2}) (DBG|INF|WRN|ERROR|FATAL|ACCESS) (.+)/
            function processLogLine(line) {
                const match = logRegex.exec(line)
                if (!match) return line
                const date = match[1]
                const level = match[2]
                const message = match[3]
                const dateSpan = document.createElement('span')
                dateSpan.classList = 'logTime'
                dateSpan.innerText = date
                const levelSpan = document.createElement('span')
                levelSpan.classList = `logLevel ${level.toLowerCase()}`
                levelSpan.innerText = level
                const messageSpan = document.createElement('span')
                messageSpan.classList = 'logMessage'
                messageSpan.innerText = message
                const lineDiv = document.createElement('div')
                lineDiv.classList = 'logLine'
                lineDiv.appendChild(dateSpan)
                lineDiv.appendChild(levelSpan)
                lineDiv.appendChild(messageSpan)
                return lineDiv
            }

            const logContent = document.querySelector('.logContent')
            const logLines = testText.split('\n')
            for (const line of logLines) {
                logContent.appendChild(processLogLine(line))
            }
        </script>
    </body>
</html>
