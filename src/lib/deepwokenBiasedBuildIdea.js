export const weapons = {
    Daggers: {
        "Flareblood Kamas": 0.25,
        "Cerulean Thread": 0.35,
        "Alloyed Whaling Knife": 0.3,
        "Alloyed Tanto": 0.15,
        Kyrsedge: 0.15,
        "Krulian Knife": 0.1,
    },
    Fists: {
        "Jus Karita": 0.25,
        "Drakemaw Gauntlets": 0.25,
        "Coral Cestus": 0.25,
        "Light's Final Toll": 0.05,
        "Way of Navae": 0.25,
        "Legion Kata": 0.1,
    },
    Guns: {
        "1 handed gun": 0.5,
        "2 handed gun": 0.1,
        "Rosen's Peacemaker": 0.3,
        "Iron Blunderbuss": 0.25,
    },
    Rapiers: {
        Kyrstreza: 0.85,
        "Crucible Rapier": 0.35,
        Skullpiercer: 0.5,
    },
    Swords: {
        "Forgotten Gladius": 0.25,
        Wyrmtooth: 0.35,
        "Serpent's Edge": 0.15,
        "Hallow's Cleave": 0.025,
        "Alloyed Messer": 0.05,
        "Alloyed Shotel": 0.05,
        "Alloyed Vigil Longsword": 0.15,
        "Alloyed Falcion": 0.1,
        Kyrsblade: 0.025,
    },
    Katanas: {
        "Alloyed Katana": 0.25,
        "Purple Cloud": 0.35,
        "Shattered Katana": 0.2,
    },
    Spears: {
        "Imperial Staff": 0.35,
        "Bloodtide Trident": 0.3,
        "Rifle Spear": 0.25,
        "True Seraph's Spear": 0.35,
        "Alloyed Trident Spear": 0.2,
        Kyrsglaive: 0.4,
    },
    Clubs: {
        Pernach: 0.55,
        "Sacred Hammer": 0.4,
    },
    Greataxes: {
        "Skyreap Blade": 0.25,
        "Pale Briar": 0.35,
        "Relic Axe": 0.3,
        "Enforcer's Axe": 0.25,
        "Evanspear Hand Axe": 0.2,
        "Night Axe": 0.05,
        "Alloyed Canorian Axe": 0.05,
        "Alloyed Halberd": 0.3,
        "Alloyed Adretian Axe": 0.05,
    },
    Greatswords: {
        "Alloyed Inheritor": 0.25,
        Kyrsieger: 0.35,
        Railblade: 0.55,
        "Darkalloy Greatsword": 0.25,
        Kyrscleave: 0.1,
        "Alloyed Crescent Cleaver": 0.1,
        "First Light": 0.2,
        "Alloyed Zweihander": 0.05,
        "Enforcer's Blade": 0.15,
    },
    Greathammers: {
        "Putrid Edenstaff": 0.25,
        Stoneheart: 0.2,
        "Hivelord's Hubris": 0.025,
        "Petra's Anchor": 0.15,
        "Sovereign's Punishment": 0.1,
        "Enforcer's Hammer": 0.15,
        "Alloyed Steel Maul": 0.05,
    },
    Attuned: {
        "Hero Blade of Flame": 0,
        "Hero Blade of Lightning": 0,
        "Hero Blade of Frost": 0,
        "Hero Blade of Wind": 0,
        "Hero Blade of Shadow": 0,
        Stormseye: 0,
        "Gran Sudaruska": 0,
        "Curved Blade of the Winds": 0,
        "Crypt Blade": 0,
        "Ignition Deepcrusher": 0,
        "Ysley's Pyre Keeper": 0,
    },
};
const weaponCategoryWeights = {
    Daggers: 0.1,
    Fists: 0.3,
    Guns: 0.05,
    Rapiers: 0.075,
    Swords: 0.3,
    Katanas: 0.5,
    Spears: 0.25,
    Clubs: 0.15,
    Greataxes: 0.3,
    Greatswords: 0.3,
    Greathammers: 0.25,
    Attuned: 0.025,
};
export const attunedWeapons = {
    Flamecharm: ["Hero Blade of Flame", "Ysley's Pyre Keeper"],
    Thundercall: ["Hero Blade of Lightning", "Stormseye"],
    Frostdraw: ["Hero Blade of Frost", "Gran Sudaruska"],
    Galebreathe: ["Hero Blade of Wind", "Curved Blade of the Winds"],
    Shadowcast: ["Hero Blade of Shadow", "Crypt Blade"],
    Ironsing: ["Ignition Deepcrusher"],
};
export const oaths = {
    Arcwarder: 0.05,
    Blindseer: 0.05,
    Contractor: 0.1,
    Dawnwalker: 0.35,
    Fadetrimmer: 0.05,
    Jetstriker: 0.1,
    Linkstrider: 0.05,
    Oathless: 0.15,
    Saltchemist: 0.15,
    Silentheart: 0.2,
    Starkindred: 0.2,
    Visionshaper: 0.1,
};
export const focuses = {
    Damage: 0.25,
    "PVE damage": 0.05,
    Penetration: 0.15,
    Support: 0.025,
    Combos: 0.25,
    Mobility: 0.1,
    Tank: 0.1,
    Zoning: 0.075,
};
export const armors = {
    "Authority Commander": 0.05,
    "Black Diver": 0.1,
    "Celtorian Tideknight": 0.05,
    "Ignition Deepdelver": 0.15,
    "Justicar's Armor": 0,
    "Legion Centurion": 0,
    "Navaen War Chief": 0,
    "Prophet's Cloak": 0.15,
    "Royal Etrean Guard": 0,
    "Summer Dragoon": 0,
    "Windrunner Robes": 0.15,
    "Ferryman's Coat": 0.05,
};
export const attunements = {
    "Attunement-less": 0.65,
    Flamecharm: 0.25,
    Frostdraw: 0.05,
    Galebreathe: 0.3,
    Thundercall: 0.15,
    Ironsing: 0.25,
    Shadowcast: 0.25,
};

export class Idea {
    weapon = "";
    attunements = [];
    armor = "";
    oath = "";
    focus = "";
    constructor({ weapon, attunements, armor, oath, focus }) {
        this.weapon = weapon;
        this.attunements = attunements;
        this.armor = armor;
        this.oath = oath;
        this.focus = focus;
    }
}

function getRandomWeightedNumber() {
    const weightedArray = [1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3];
    const randomIndex = Math.floor(Math.random() * weightedArray.length);
    return weightedArray[randomIndex];
}

export function getRandomAttunement() {
    const amount = getRandomWeightedNumber();
    let attunementsArr = [];

    let weightedArray = [];
    for (let attunement in attunements) {
        let count = attunements[attunement] * 100; // Multiply by 100 to get a whole number
        for (let i = 0; i < count; i++) {
            weightedArray.push(attunement);
        }
    }
    let i = 0;
    while (attunementsArr.length < amount) {
        i++;
        // Get a random index
        let randomIndex = Math.floor(Math.random() * weightedArray.length);
        if (weightedArray[randomIndex] == "Attunement-less" && i == 1) {
            attunementsArr = ["Attunement-less"];
            break;
        }

        while (attunementsArr.includes(weightedArray[randomIndex])) {
            randomIndex = Math.floor(Math.random() * weightedArray.length);
        }
        // Return the attunement at the random index
        if (weightedArray[randomIndex] !== "Attunement-less") {
            attunementsArr.push(weightedArray[randomIndex]);
        } // TODO: increase chance of 2 attunements
    }
    if (attunementsArr.length == 0) {
        let randomIndex = Math.floor(Math.random() * weightedArray.length);
        attunementsArr.push(weightedArray[randomIndex]);
    }
    return attunementsArr;
}

export function getRandomWeaponCategory(weights, attunements) {
    let category = "";
    let weightedArray = [];
    for (let category in weights.weaponCategory) {
        let count = weights.weaponCategory[category] * 100; // Multiply by 100 to get a whole number
        for (let i = 0; i < count; i++) {
            weightedArray.push(category);
        }
    }
    let randomIndex = Math.floor(Math.random() * weightedArray.length);
    category = weightedArray[randomIndex];

    if (attunements.includes("Attunement-less") && category === "Attuned") {
        while (category === "Attuned") {
            randomIndex = Math.floor(Math.random() * weightedArray.length);
            category = weightedArray[randomIndex];
        }
    }

    return category;
}

export function getRandomWeapon(weights, category) {
    let weapon = "";
    let weightedArray = [];
    for (let weapon in weights.weapons[category]) {
        let count = weights.weapons[category][weapon] * 100; // Multiply by 100 to get a whole number
        for (let i = 0; i < count; i++) {
            weightedArray.push(weapon);
        }
    }
    let randomIndex = Math.floor(Math.random() * weightedArray.length);
    weapon = weightedArray[randomIndex];
    return weapon;
}

export function getRandomArmor(weights) {
    let armor = "";
    let weightedArray = [];
    for (let armor in weights.armors) {
        let count = weights.armors[armor] * 100; // Multiply by 100 to get a whole number
        for (let i = 0; i < count; i++) {
            weightedArray.push(armor);
        }
    }
    let randomIndex = Math.floor(Math.random() * weightedArray.length);
    armor = weightedArray[randomIndex];
    return armor;
}
export function getRandomOath(weights, attunements) {
    let oath = "";
    let weightedArray = [];
    for (let oath in weights.oaths) {
        let count = weights.oaths[oath] * 100; // Multiply by 100 to get a whole number
        for (let i = 0; i < count; i++) {
            weightedArray.push(oath);
        }
    }
    let randomIndex = Math.floor(Math.random() * weightedArray.length);
    oath = weightedArray[randomIndex];
    if (!attunements.includes("Attunement-less")) {
        while (oath == "Silentheart") {
            let randomIndex = Math.floor(Math.random() * weightedArray.length);
            oath = weightedArray[randomIndex];
        }
    }
    return oath;
}
export function getRandomFocus(weights) {
    let focus = "";
    let weightedArray = [];
    for (let focus in weights.focuses) {
        let count = weights.focuses[focus] * 100; // Multiply by 100 to get a whole number
        for (let i = 0; i < count; i++) {
            weightedArray.push(focus);
        }
    }
    let randomIndex = Math.floor(Math.random() * weightedArray.length);
    focus = weightedArray[randomIndex];
    return focus;
}

export function getWeights() {
    return {
        weaponCategory: weaponCategoryWeights,
        weapons: weapons,
        oaths: oaths,
        focuses: focuses,
        armors: armors,
        attunements: attunements,
    };
}

export function adjustWeightsForAttunements(weights, attunements) {
    let newWeights = weights;
    attunements.forEach((attunement) => {
        switch (attunement) {
            case "Attunement-less":
                newWeights.oaths.Silentheart += 0.25;
                newWeights.weaponCategory.Attuned = 0;
            case "Flamecharm":
                newWeights.weaponCategory.Attuned += 0.5;
                newWeights.weapons.Attuned["Ysley's Pyre Keeper"] += 0.5;
                newWeights.weapons.Attuned["Hero Blade of Flame"] += 0.5;
                newWeights.focuses.Damage += 0.15;
                break;
            case "Thundercall":
                newWeights.weaponCategory.Attuned += 0.5;
                newWeights.weapons.Attuned["Hero Blade of Lightning"] += 0.5;
                newWeights.weapons.Attuned["Stormseye"] += 0.5;
                break;
            case "Frostdraw":
                newWeights.weaponCategory.Attuned += 0.5;
                newWeights.weapons.Attuned["Hero Blade of Frost"] += 0.5;
                newWeights.weapons.Attuned["Gran Sudaruska"] += 0.5;
                newWeights.focuses.Damage += 0.15;
                newWeights.focuses["PVE Damage"] += 0.1;
                break;
            case "Galebreathe":
                newWeights.weaponCategory.Attuned += 0.5;
                newWeights.weapons.Attuned["Hero Blade of Wind"] += 0.5;
                newWeights.weapons.Attuned["Curved Blade of the Winds"] += 0.5;
                newWeights.oaths.Jetstriker += 0.15;
                newWeights.focuses.Mobility += 0.1;
                newWeights.armors["Windrunner Robes"] += 0.35;
                newWeights.focuses.combos += 0.25;
                break;
            case "Shadowcast":
                newWeights.weaponCategory.Attuned += 0.5;
                newWeights.weapons.Attuned["Hero Blade of Shadow"] += 0.5;
                newWeights.weapons.Attuned["Crypt Blade"] += 0.5;
                newWeights.oaths.Contractor += 0.15;
                newWeights.focuses.Zoning += 0.15;
                break;
            case "Ironsing":
                newWeights.weaponCategory.Attuned += 0.5;
                newWeights.weapons.Attuned["Ignition Deepcrusher"] += 0.5;
                newWeights.focuses.Zoning += 0.15;
                break;
            default:
                break;
        }
    });
    if (!attunements.includes("Attunement-less")) {
        newWeights.oaths.Oathless += 0.15;
        newWeights.oaths.Dawnwalker += 0.15;
    }
    if (
        attunements.includes("Flamecharm") &&
        attunements.includes("Thundercall")
    ) {
        newWeights.oaths.Arcwarder += 0.45;
    }
    return newWeights;
}

export function adjustWeightsForWeapon(weights, weapon, category) {
    let newWeights = weights;
    switch (weapon) {
        case "Evanspear Hand Axe":
            newWeights.focuses["PVE Damage"] += 0.25;
            break;
        case "Gran Sudaruska":
            newWeights.focuses["PVE Damage"] += 0.25;
            break;
        case "Curved Blade of the Winds":
            newWeights.focuses.Combos += 0.25;
            break;
        case "Flareblood Kamas":
            newWeights.focuses.Combos += 0.25;
            break;
        case "Pale Briar":
            newWeights.focuses.Combos += 0.25;
            break;
        case "Hivelord's Hubris":
            newWeights.focuses.Damage += 0.25;
            break;
        default:
            break;
    }

    switch (category) {
        case "Katanas":
            newWeights.armors["Royal Etrean Guard"] += 0.45;
            break;
        case "Guns":
            newWeights.armors["Summer Dragoon"] += 0.45;
            break;
        default:
            break;
    }
    if (category == "Fists") {
        if (weapon == "Jus Karita") {
            newWeights.armors["Justicar"] += 0.45;
        } else if (
            weapon ==
            ("Way of Navae" ||
                "Coral Cestus" ||
                "Drakemaw Gauntlets" ||
                "Flamekeeper Cestus")
        ) {
            newWeights.armors["Navaen War Chief"] += 0.45;
        } else if (
            weapon ==
            ("Legion Kata" ||
                "Coral Cestus" ||
                "Drakemaw Gauntlets" ||
                "Flamekeeper Cestus")
        ) {
            newWeights.armors["Legion Centurion"] += 0.45;
        } else if (weapon == "Light's Final Toll") {
            newWeights.oaths.Blindseer += 0.55;
        }
    }
    return newWeights;
}

export function adjustWeightsForArmor(weights, armor) {
    let newWeights = weights;
    switch (armor) {
        case "Authority Commander":
            newWeights.focuses.Tank += 0.25;
            break;
        case "Black Diver":
            newWeights.focuses.Tank += 0.15;
            break;
        case "Celtorian Tideknight":
            newWeights.focuses["PVE Damage"] += 0.9;
            break;
        case "Ignition Deepdelver":
            newWeights.focuses.Tank += 0.25;
            break;
        case "Justicar's Armor":
            newWeights.focuses.Damage += 0.25;
            break;
        case "Legion Centurion":
            newWeights.focuses.Damage += 0.25;
            break;
        case "Navaen War Chief":
            newWeights.focuses.Penetration += 0.25;
            break;
        case "Prophet's Cloak":
            newWeights.focuses.Penetration += 0.25;
            break;
        case "Royal Etrean Guard":
            newWeights.focuses.Damage += 0.25;
            break;
        case "Summer Dragoon":
            newWeights.focuses.Support += 0.25;
            break;
        case "Windrunner Robes":
            newWeights.focuses.Mobility += 0.25;
            newWeights.focuses.Zoning += 0.25;
            break;
        case "Ferryman's Coat":
            newWeights.focuses.Tank += 0.1;
            break;
        default:
            break;
    }
    return newWeights;
}

export function adjustWeightsForFocus(weights, focus) {
    let newWeights = weights;
    switch (focus) {
        case "Damage":
            newWeights.oaths.Silentheart += 0.25;
            break;
        case "PVE damage":
            newWeights.oaths.Silentheart += 0.35;
            newWeights.oaths.Dawnwalker += 0.25;
            newWeights.oaths.Blindseer += 0.15;
            break;
        case "Penetration":
            newWeights.oaths.Silentheart += 0.25;
            break;
        case "Support":
            newWeights.oaths.Saltchemist += 0.25;
            newWeights.oaths.Linkstrider += 0.35;
            newWeights.oaths.Blindseer += 0.3;
            break;
        case "Combos":
            newWeights.oaths.Dawnwalker += 0.25;
            newWeights.oaths.Starkindred += 0.25;
            newWeights.oaths.Visionshaper += 0.25;
            newWeights.oaths.Oathless += 0.25;
            newWeights.oaths.Jetstriker += 0.25;
            break;
        case "Mobility":
            newWeights.oaths.Jetstriker += 0.25;
            break;
        case "Tank":
            newWeights.oaths.Silentheart += 0.25;
            newWeights.oaths.Arcwarder += 0.25;
            break;
        case "Zoning":
            newWeights.oaths.Arcwarder += 0.25;
            newWeights.oaths.Contractor += 0.25;
            break;
        default:
            break;
    }
    return newWeights;
}

export function fixAttunementLacking(weapon, attunements, oath) {
    switch (weapon) {
        case "Hero Blade of Flame":
            if (!attunements.includes("Flamecharm")) {
                attunements.push("Flamecharm");
            }
            break;
        case "Hero Blade of Lightning":
            if (!attunements.includes("Thundercall")) {
                attunements.push("Thundercall");
            }
            break;
        case "Hero Blade of Frost":
            if (!attunements.includes("Frostdraw")) {
                attunements.push("Frostdraw");
            }
            break;
        case "Hero Blade of Wind":
            if (!attunements.includes("Galebreathe")) {
                attunements.push("Galebreathe");
            }
            break;
        case "Hero Blade of Shadow":
            if (!attunements.includes("Shadowcast")) {
                attunements.push("Shadowcast");
            }
            break;
        case "Ignition Deepcrusher":
            if (!attunements.includes("Ironsing")) {
                attunements.push("Ironsing");
            }
            break;
        case "Ysley's Pyre Keeper":
            if (!attunements.includes("Flamecharm")) {
                attunements.push("Flamecharm");
            }
            break;
        case "Stormseye":
            if (!attunements.includes("Thundercall")) {
                attunements.push("Thundercall");
            }
            break;
        case "Gran Sudaruska":
            if (!attunements.includes("Frostdraw")) {
                attunements.push("Frostdraw");
            }
            break;
        case "Curved Blade of the Winds":
            if (!attunements.includes("Galebreathe")) {
                attunements.push("Galebreathe");
            }
            break;
        case "Crypt Blade":
            if (!attunements.includes("Shadowcast")) {
                attunements.push("Shadowcast");
            }
            break;
        default:
            break;
    }
    switch (oath) {
        case "Arcwarder":
            if (
                !attunements.includes("Flamecharm") &&
                !attunements.includes("Thundercall")
            ) {
                attunements.push("Flamecharm");
                attunements.push("Thundercall");
            }
            break;
        default:
            break;
    }
    return attunements;
}

export function randomBuildIdea() {
    let weights = getWeights();
    let attunements = getRandomAttunement();
    weights = adjustWeightsForAttunements(weights, attunements);
    const weaponCategory = getRandomWeaponCategory(weights, attunements);
    const weapon = getRandomWeapon(weights, weaponCategory);
    weights = adjustWeightsForWeapon(weights, weapon, weaponCategory);
    const armor = getRandomArmor(weights);
    weights = adjustWeightsForArmor(weights, armor);
    const focus = getRandomFocus(weights);
    adjustWeightsForFocus(weights, focus);
    const oath = getRandomOath(weights, attunements);
    attunements = fixAttunementLacking(weapon, attunements, oath);
    let idea = new Idea({
        weapon: weapon,
        attunements: attunements,
        armor: armor,
        oath: oath,
        focus: focus,
    });

    return idea;
}
